/*--------------------------------*- C++ -*----------------------------------*\
| =========                 |                                                 |
| \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox           |
|  \\    /   O peration     | Version:  v2406                                 |
|   \\  /    A nd           | Website:  www.openfoam.com                      |
|    \\/     M anipulation  |                                                 |
\*---------------------------------------------------------------------------*/
FoamFile
{
    version     2.0;
    format      ascii;
    class       dictionary;
    object      snappyHexMeshDict;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

// Which of the steps to run
castellatedMesh true;
snap            true;
addLayers       true;

   
// Geometry. Definition of all surfaces. All surfaces are of class
// searchableSurface.
geometry
{
    seed.stl
    {
        type triSurfaceMesh;
        name seed;
    }
    /*
    refinementBox
    {
        type box;
        min  (-0.15e-1 -0.15e-1 -2e-1);
        max  ( 0.15e-1 0.15e-1 2e-1);
    }
    
    refinementBox
    {
        type searchableCylinder;
        point1  ( 0 0 -1);
        point2  ( 0 0 3);
        radius 0.35;
    }*/
    
}


// Settings for the castellatedMesh generation.
castellatedMeshControls
{

    // Refinement parameters
    maxLocalCells 8000;  // Increased to allow more cells
    maxGlobalCells 300000; // Increased to refine smaller details

    minRefinementCells 20;  // Allow for finer refinement

    nCellsBetweenLevels 3;  // Finer control over the refinement levels

    // Explicit feature edge refinement
    features
    (
        {
            file "seed.eMesh";
            level 6;
        }
    );

    // Surface based refinement
    refinementSurfaces
    {
        seed
        {
            // Surface-wise min and max refinement level
            level (9 9);  // Increased refinement levels

            patchInfo
            {
                type wall;
                inGroups (seed);
            }
        }
    }

    // Resolve sharp angles
    resolveFeatureAngle 10;  // Refine more around sharp features

    refinementRegions
    {
        /*refinementBox
        {
            mode inside;
            levels ((1E17 1));
        }*/
    }

    locationInMesh ( -0.09 0.03 -1e-1);  // Adjusted to ensure correct location in the mesh

    allowFreeStandingZoneFaces true;
}


// Settings for the snapping.
snapControls
{
    nSmoothPatch 3;
    tolerance 2;  // Adjusted tolerance for better snapping
    nSolveIter 40;  // Increased iterations for smoother snapping
    nRelaxIter 8;  // More relaxation iterations

    nFeatureSnapIter 25;  // Higher iterations to capture detailed features

    implicitFeatureSnap false;
    explicitFeatureSnap true;
    multiRegionFeatureSnap false;
}


// Settings for the layer addition.
addLayersControls
{
    relativeSizes true;

    layers
    {
        "(lowerWall|motorBike).*"
        {
            nSurfaceLayers 1;  // Increased to capture finer details
        }
    }

    expansionRatio 1.2;  // Slower expansion for smoother layers
    finalLayerThickness 0.0004;  // Adjusted to match the small thickness of the seed
    minThickness 0.0001;  // Thinner layers for better fit

    nGrow 0;
    featureAngle 60;
    slipFeatureAngle 30;
    nRelaxIter 3;
    nSmoothSurfaceNormals 1;
    nSmoothNormals 3;
    nSmoothThickness 10;
    maxFaceThicknessRatio 0.5;
    maxThicknessToMedialRatio 0.3;
    minMedialAxisAngle 90;
    nBufferCellsNoExtrude 0;
    nLayerIter 50;
}


// Generic mesh quality settings. At any undoable phase these determine
// where to undo.
meshQualityControls
{
    #include "meshQualityDict"
    nSmoothScale 4;
    errorReduction 0.75;
}


// Advanced

writeFlags
(
    scalarLevels
    layerSets
    layerFields     // write volScalarField for layer coverage
);

mergeTolerance 1e-6;

// ************************************************************************* //
